SUMMARY = "Autot image main application"
DESCRIPTION = "Main application for Autotester with libraries built with cross SDK separately"
LICENSE = "CLOSED"

python do_display_banner() {
    bb.plain("***********************************************");
    bb.plain("*                                             *");
    bb.plain("*  farviewpcan application with libraries     *");
    bb.plain("*                                             *");
    bb.plain("***********************************************");
}

addtask display_banner before do_build

FILESEXTRAPATHS:prepend := "${THISDIR}/../../additions/prjdeploy/:"

SRC_URI = "file://farviewpcan"

S = "${WORKDIR}/farviewpcan"

do_install() {
    install -d ${D}${libdir}
    install -m 0644 ${S}/lib/* ${D}${libdir}/
# it doesn't work to copy shared libraries .so together with symbolic link files
# either select hard link .so files to install
# or leave only hard link .so files in the source folder and then copy all together
#    install -m 0644 ${S}/lib/libpcan.so.6 ${D}${libdir}/
    ln -sf libpcan.so.6 ${D}${libdir}/libpcan.so
#    install -m 0644 ${S}/lib/libpcanfd.so.8 ${D}${libdir}/
    ln -sf libpcanfd.so.8 ${D}${libdir}/libpcanfd.so
#    install -m 0644 ${S}/lib/libpcanfd.a ${D}${libdir}/
#    install -m 0644 ${S}/lib/libpcanbasic.so.4.8.0 ${D}${libdir}/
    ln -sf libpcanbasic.so.4.8.0 ${D}${libdir}/libpcanbasic.so
    ln -sf libpcanbasic.so.4.8.0 ${D}${libdir}/libpcanbasic.so.4

    install -d ${D}${includedir}
    install -m 0644 ${S}/include/* ${D}${includedir}/

    install -d ${D}${bindir}
    install -m 0755 ${S}/tools/pcaninfo.1.3.2 ${D}${bindir}/
    ln -sf pcaninfo.1.3.2 ${D}${bindir}/pcaninfo
    install -m 0755 ${S}/farviewpcan ${D}${bindir}/
    install -m 0755 ${S}/pcantest.sh ${D}${bindir}/
}
#FILES:${PN} += "${libdir}/libpcan.so.6
#FILES:${PN} += "${libdir}/libpcanfd.so.8
#FILES:${PN} += "${libdir}/libpcanbasic.so.4.8.0
# no need of above three lines
